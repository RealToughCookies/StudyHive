<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Profile - StudyHive</title>
  <meta name="theme-color" content="#f7f3eb">
    <script>
      // Apply theme immediately to prevent flash
      (function() {
        const savedTheme = localStorage.getItem("theme") || "light";
        if (savedTheme === "dark") {
          document.documentElement.setAttribute("data-theme", "dark");
          const metaThemeColor = document.querySelector('meta[name="theme-color"]');
          if (metaThemeColor) {
            metaThemeColor.setAttribute("content", "#0a1624");
          }
        }
      })();
    </script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="app">
      <header class="app__header">
        <div class="app__header-top">
          <div class="app__brand">
            <img src="StudyHiveLogo.png" alt="StudyHive logo" class="app__logo" />
            <h1>StudyHive</h1>
          </div>
          <a href="profile.html" class="profile-button profile-button--active" title="Profile">
            <span class="profile-button__avatar">SH</span>
          </a>
        </div>
        <p class="app__tagline">Stay focused, take breaks, track progress.</p>
        <nav class="app__nav" aria-label="Primary">
          <a class="app__nav-link" href="index.html">Focus Timer</a>
          <a class="app__nav-link" href="courses.html">Courses</a>
          <a class="app__nav-link" href="notes.html">Notes</a>
          <a class="app__nav-link" href="cheatsheets.html">Cheat Sheets</a>
          <a class="app__nav-link" href="quizzes.html">Quizzes</a>
          <a class="app__nav-link" href="history.html">History</a>
        </nav>
      </header>

      <section class="profile">
        <div class="profile__header">
          <div class="profile__avatar">
            <div class="profile__avatar-circle">
              <span class="profile__avatar-initials" id="user-initials">SH</span>
            </div>
          </div>
          <div class="profile__info">
            <h2 class="profile__name" id="user-name">Study Hero</h2>
            <p class="profile__joined">Member since <span id="join-date">Today</span></p>
          </div>
        </div>

        <div class="profile__stats">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-card__value" id="total-sessions">0</div>
              <div class="stat-card__label">Study Sessions</div>
            </div>
            <div class="stat-card">
              <div class="stat-card__value" id="total-time">0h 0m</div>
              <div class="stat-card__label">Total Focus Time</div>
            </div>
            <div class="stat-card">
              <div class="stat-card__value" id="current-streak">0</div>
              <div class="stat-card__label">Day Streak</div>
            </div>
            <div class="stat-card">
              <div class="stat-card__value" id="best-streak">0</div>
              <div class="stat-card__label">Best Streak</div>
            </div>
          </div>
        </div>

        <div class="profile__goals">
          <h3>Daily Goals</h3>
          <div class="goals-container">
            <div class="goal-item">
              <div class="goal-item__header">
                <span class="goal-item__label">Daily Study Time</span>
                <span class="goal-item__progress" id="daily-progress">0 / 2 hours</span>
              </div>
              <div class="goal-item__bar">
                <div class="goal-item__fill" id="daily-progress-bar" style="width: 0%"></div>
              </div>
            </div>
            <div class="goal-item">
              <div class="goal-item__header">
                <span class="goal-item__label">Study Sessions</span>
                <span class="goal-item__progress" id="session-progress">0 / 4 sessions</span>
              </div>
              <div class="goal-item__bar">
                <div class="goal-item__fill" id="session-progress-bar" style="width: 0%"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="profile__achievements">
          <h3>Achievements</h3>
          <canvas id="confetti-canvas"></canvas>
          <div class="achievements-grid">
            <div class="achievement" data-achievement="first-session">
              <div class="achievement__icon">üéØ</div>
              <div class="achievement__info">
                <div class="achievement__title">First Steps</div>
                <div class="achievement__desc">Complete your first study session</div>
              </div>
            </div>
            <div class="achievement" data-achievement="week-streak">
              <div class="achievement__icon">üî•</div>
              <div class="achievement__info">
                <div class="achievement__title">Week Warrior</div>
                <div class="achievement__desc">Study for 7 days in a row</div>
              </div>
            </div>
            <div class="achievement" data-achievement="hour-master">
              <div class="achievement__icon">‚è∞</div>
              <div class="achievement__info">
                <div class="achievement__title">Hour Master</div>
                <div class="achievement__desc">Study for 10 hours total</div>
              </div>
            </div>
            <div class="achievement" data-achievement="focus-champion">
              <div class="achievement__icon">üèÜ</div>
              <div class="achievement__info">
                <div class="achievement__title">Focus Champion</div>
                <div class="achievement__desc">Complete 50 study sessions</div>
              </div>
            </div>
          </div>
        </div>

        <div class="profile__settings">
          <h3>Profile Settings</h3>
          <form class="settings-form" id="profile-settings-form">
            <div class="settings__group">
              <label for="display-name">Display Name</label>
              <input type="text" id="display-name" value="Study Hero" maxlength="30" />
            </div>
            <div class="settings__group">
              <label for="daily-goal">Daily Study Goal (hours)</label>
              <input type="number" id="daily-goal" min="0.5" max="12" step="0.5" value="2" />
            </div>
            <div class="settings__group">
              <label for="session-goal">Daily Session Goal</label>
              <input type="number" id="session-goal" min="1" max="20" value="4" />
            </div>
            <div class="settings__group">
              <label class="toggle-label">
                <span class="toggle-label__text">Dark Mode</span>
                <div class="toggle-switch">
                  <input type="checkbox" id="theme-toggle" class="toggle-switch__input" />
                  <span class="toggle-switch__slider"></span>
                </div>
              </label>
            </div>
            <div class="settings__group">
              <label>
                <input type="checkbox" id="notifications-enabled" checked />
                Enable motivational notifications
              </label>
            </div>
            <button type="submit" class="secondary">Save Settings</button>
          </form>
        </div>

        <div class="profile__settings">
          <h3>AI Quiz Settings</h3>
          <p style="color: var(--muted); font-size: 0.9rem; margin: 0 0 1rem 0;">
            Enable AI-powered quiz generation and grading with detailed explanations for wrong answers.
          </p>

          <!-- Browser AI Option -->
          <div class="settings__group">
            <label class="toggle-label">
              <span class="toggle-label__text">
                <strong>Use Browser Built-in AI (Free, No API Key Needed)</strong>
                <br>
                <small style="color: var(--muted); font-size: 0.85rem;">
                  Works in Chrome/Edge with Gemini Nano. Runs locally on your device.
                </small>
              </span>
              <div class="toggle-switch">
                <input type="checkbox" id="use-browser-ai" class="toggle-switch__input" />
                <span class="toggle-switch__slider"></span>
              </div>
            </label>
          </div>

          <div id="browser-ai-status" style="display: none; padding: 0.75rem; background: rgba(6, 214, 160, 0.1); border: 1px solid rgba(6, 214, 160, 0.3); border-radius: 8px; color: #06d6a0; margin-bottom: 1rem;">
            ‚úì Browser AI Active
          </div>

          <div id="browser-ai-unavailable" style="display: none; padding: 0.75rem; background: rgba(239, 71, 111, 0.1); border: 1px solid rgba(239, 71, 111, 0.3); border-radius: 8px; color: #ef476f; margin-bottom: 1rem;">
            Browser AI not available. Please use Chrome 127+ or Edge 127+ with the AI feature enabled.
          </div>

          <!-- OR Separator -->
          <div style="text-align: center; margin: 1.5rem 0; color: var(--muted); font-weight: 600;">
            ‚Äî OR ‚Äî
          </div>

          <!-- Web LLM Option (RECOMMENDED) -->
          <div class="settings__group">
            <label class="toggle-label">
              <span class="toggle-label__text">
                <strong>Use Web LLM (Free, Private, Powerful - RECOMMENDED ‚≠ê)</strong>
                <br>
                <small style="color: var(--muted); font-size: 0.85rem;">
                  Run AI models in your browser using WebGPU. Free, private, works offline. Chrome/Edge 113+
                </small>
              </span>
              <div class="toggle-switch">
                <input type="checkbox" id="use-webllm" class="toggle-switch__input" />
                <span class="toggle-switch__slider"></span>
              </div>
            </label>
          </div>

          <div id="webllm-settings" style="display: none; padding: 1rem; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 1rem;">
            <div class="settings__group">
              <label for="webllm-model">
                <strong>Select Model</strong>
              </label>
              <select id="webllm-model" style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-primary); color: var(--text);">
                <option value="Phi-3-mini-4k-instruct-q4f16_1-MLC">Phi-3 Mini (2.4GB) - Recommended</option>
                <option value="TinyLlama-1.1B-Chat-v1.0-q4f16_1-MLC">TinyLlama (655MB) - Fastest</option>
                <option value="Llama-3-8B-Instruct-q4f32_1-MLC">Llama 3 8B (4.9GB) - Best Quality</option>
                <option value="Mistral-7B-Instruct-v0.3-q4f16_1-MLC">Mistral 7B (4.2GB) - Best Quality</option>
              </select>
              <p style="color: var(--muted); font-size: 0.85rem; margin: 0.5rem 0 0 0;">
                Larger models = better quality but slower download. Model is cached after first download.
              </p>
            </div>

            <div id="webllm-download-section" style="display: block;">
              <button type="button" class="primary" id="download-webllm-model" style="width: 100%;">
                Download Model
              </button>
            </div>

            <div id="webllm-progress" style="display: none; margin-top: 1rem;">
              <div style="margin-bottom: 0.5rem;">
                <span id="webllm-progress-text" style="color: var(--muted); font-size: 0.9rem;">Initializing...</span>
              </div>
              <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                <div id="webllm-progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #06d6a0, #1b9aaa); transition: width 0.3s ease;"></div>
              </div>
            </div>

            <div id="webllm-ready" style="display: none; padding: 0.75rem; background: rgba(6, 214, 160, 0.1); border: 1px solid rgba(6, 214, 160, 0.3); border-radius: 8px; color: #06d6a0; margin-top: 1rem;">
              ‚úì Web LLM Ready - AI quizzes enabled!
            </div>

            <div id="webllm-error" style="display: none; padding: 0.75rem; background: rgba(239, 71, 111, 0.1); border: 1px solid rgba(239, 71, 111, 0.3); border-radius: 8px; color: #ef476f; margin-top: 1rem;">
              <strong>Error:</strong> <span id="webllm-error-text"></span>
            </div>
          </div>

          <!-- OR Separator -->
          <div style="text-align: center; margin: 1.5rem 0; color: var(--muted); font-weight: 600;">
            ‚Äî OR ‚Äî
          </div>

          <!-- Cloud API Option -->
          <form class="settings-form" id="ai-settings-form">
            <div class="settings__group">
              <label for="claude-api-key">
                <strong>Claude API Key (Cloud-based)</strong>
                <br>
                <small style="color: var(--muted); font-size: 0.85rem;">
                  More powerful but requires paid API key
                </small>
              </label>
              <input type="password" id="claude-api-key" placeholder="sk-ant-..." />
              <p style="color: var(--muted); font-size: 0.85rem; margin: 0.5rem 0 0 0;">
                Get your API key from <a href="https://console.anthropic.com/" target="_blank" style="color: var(--accent);">console.anthropic.com</a>
              </p>
            </div>
            <div class="settings__group" id="ai-status" style="display: none;">
              <div style="padding: 0.75rem; background: rgba(6, 214, 160, 0.1); border: 1px solid rgba(6, 214, 160, 0.3); border-radius: 8px; color: #06d6a0;">
                ‚úì Cloud AI Active
              </div>
            </div>
            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
              <button type="submit" class="primary">Save API Key</button>
              <button type="button" class="secondary" id="test-ai">Test AI</button>
              <button type="button" class="secondary" id="clear-api-key">Clear Key</button>
            </div>
          </form>
        </div>

        <div class="profile__actions">
          <button type="button" class="danger" id="reset-stats">Reset All Statistics</button>
          <button type="button" class="secondary" id="export-data">Export Study Data</button>
        </div>
      </section>
    </main>

    <script type="module" src="web-llm-bridge.js"></script>
    <script defer src="script.js"></script>
  </body>
</html>